# OneBot RPC - 动作响应

OneBot 标准中包含了对传输数据格式的规定和要求，下面是对动作响应（Action Response）的定义和传输的说明。

## 格式

- 每个动作响应的数据都**必须**使用 JSON 格式进行传递
- 动作响应**必须**由 OneBot 实现或 libonebot 库返回给 OneBot 逻辑代码端

## 字段

动作响应**必须**包含以下字段：

字段名 | 变量类型 | 说明
--- | --- | ---
`retcode` | int | 状态码
`data` | array | 返回的数据

为了提升用户的体验，动作响应**应该**包含以下字段：

字段名 | 变量类型 | 说明
--- | --- | ---
`status` | string | ok 或 failed
`message` | string | 如果状态码返回异常，**推荐**在此填写相应的提示语

以下为合规的动作响应数据格式：
```json
{
    "status": "ok",
    "retcode": 0,
    "data": {
        "id": 123456,
        "nickname": "滑稽"
    }
}
```

```json
{
    "status": "failed",
    "retcode": 11002,
    "message": "动作 `blahblah` 不存在",
    "data": []
}
```

## 错误码

OneBot 标准规定了统一的错误码返回，但为了做好泛处理，Onebot 实现除了几个特定的固定错误外，其他错误码均为划段区分。

- `0`：成功
- `11xxx`：动作请求错误
    - `11001`：请求格式不正确（不是正确的 JSON 对象等）
    - `11002`：请求的动作不存在
    - `11003`：请求参数缺失
    - `11004`：请求参数类型或格式错误（消息格式错误属于此类）
    - ……

目前，OneBot API 响应，在动作类出现错误的时候，**需要**以 11 开头，除去目前标准规定的 4 个外，其余可自行在后三位定义。

对于其他错误，**需要**按照下方的段落进行定义：

- `12xxx`：动作执行错误
    - `121xx`：数据库访问错误
        - 可细分
    - `122xx`：文件访问错误
    - `123xx`：聊天平台 API 请求发生意外错误（QQ 服务器没有正确响应等）
    - `124xx`：动作本身逻辑错误（尝试退出自己并不在的群等）
- 如有需要，定义其它
- `9xxxx`：OneBot 实现自行定义的错误

在 OneBot 逻辑端处理错误码时，如果只是做宽泛的处理，不细分错误类型**可以**只判断前一位或前两位。