# 错误码

OneBot 标准规定了统一的错误码返回，但为了做好泛处理，Onebot 实现除了几个特定的固定错误外，其他错误码均为划段区分。

OneBot 错误码除成功外，均由 5 位组成，当后方数字为 0，可代表一类错误的泛型，后方数字不为 0，代表一个具体的错误。例如 `30000` 代表所有的动作执行错误，而 `34001` 假设可以代表好友拒收了用户消息这种具体的执行错误。

除成功状态码外，标准中规定的错误码有「宽泛」和「具体」错误码两种，宽泛错误码一般用于粗略判断错误类型而不去考虑细分的具体错误，具体错误码一般用于 bug 调试。

## 0 - 成功

一般情况下，只要是动作请求和执行均无任何错误，一律返回 `0` 即可。

## 1xxxx - 动作请求错误

动作请求错误为请求本身的错误，此时错误应该由 LibOneBot 库或 OneBot 实现内的负责通信方式的逻辑跳出执行。

动作请求错误目前标准规定为 10 开头的数字，一般情况下**不可**自定义此段内的错误。

错误码 | 错误码类型 | 错误说明 | 备注
--- | --- | --- | ---
`10000` | 宽泛 | 动作请求错误 | 可代表所有动作请求错误
`10001` | 具体 | 无效的动作请求（不是正确的 JSON、WebPack 对象等） | 一般适用于 JSON 对象解析不合法等情况
`10002` | 具体 | 不支持的动作请求 | OneBot 实现没有实现该动作
`10003` | 具体 | 无效的动作请求参数 | 一般在动作请求时检测到 `params` 内缺少必需的参数时返回
`10004` | 具体 | 不支持的动作请求参数 | OneBot 实现没有实现该参数的语义
`10005` | 具体 | 不支持的消息段类型 | OneBot 实现没有实现该消息段类型
`10006` | 具体 | 无效的消息段参数 | 消息段的参数缺失或参数类型错误
`10007` | 具体 | 不支持的消息段参数 | OneBot 实现没有实现该消息段内某参数的语义

=== "错误请求示例"

    ```json
    {
        "action": "send_message",
        "params": {
            "message": [
                {
                    "type": "invalid_type_name",
                    "data": {
                        "text": "你好啊"
                    }
                }
            ],
            "detail_type": "private",
            "user_id": "123456"
        }
    }
    ```

=== "错误响应示例"

    ```json
    {
        "status": "failed",
        "retcode": 10005,
        "message": "不支持的消息段类型 `invalid_type_name`",
        "data": []
    }
    ```

## 2xxxx - 动作处理器错误

动作处理器错误类似 HTTP 的 5xx 服务端错误，是由于未捕获的异常被抛出导致的错误。一般情况下 OneBot 实现不应出现此类错误，如果出现，请反馈 OneBot 实现或 LibOneBot 开发者。

动作请求错误目前标准规定为 20 开头的数字，**不可**自定义此段内的错误。

错误码 | 错误码类型 | 错误说明 | 备注
--- | --- | --- | ---
`20000` | 宽泛 | 动作处理器错误 | 可代表所有动作处理器错误
`20001` | 具体 | 动作处理器实现错误 | 如没有正确设置响应状态等
`20002` | 具体 | 动作处理器运行时抛出异常 | 在 OneBot 实现内部所有未捕获的意料之外的异常都应使用此错误码

## 3xxxx - 动作执行错误

动作执行错误为动作请求成功，但执行动作的过程中出现了不可忽略的异常，使得动作执行失败的错误。

动作执行错误目前标准规定为 3 开头的数字，下表几个规定的错误码为宽泛的错误类型，对应大类错误均可由 OneBot 实现在后三位定义，例如文件不存在可规定为 `32001`。

错误码 | 错误码类型 | 错误说明 | 备注
--- | --- | --- | ---
`30000` | 宽泛 | 动作执行错误 | 可代表所有动作执行错误
`31000` | 宽泛 | 数据库错误 | 一般因 OneBot 实现使用的数据库产生了问题而产生
`32000` | 宽泛 | 文件系统错误 | 文件系统造成的动作执行错误，例如无法读取文件等
`33000` | 宽泛 | 网络错误 | 网络通信失败造成的动作执行错误，如无法下载文件等
`34000` | 宽泛 | 聊天平台错误 | 如由于聊天平台限制导致消息发送失败等
`35000` | 宽泛 | 动作逻辑错误 | 如尝试向不存在的用户发送消息等
`36000` | 宽泛 | 我不想干了 | 一位 OneBot 实现决定罢工（I am tired!!!）

为了让开发者明确使用 OneBot 宽泛错误码，下面是以现有平台假定出来的错误：

> 此处只是举例说明宽泛错误码的选择，后方的具体错误码请在实际开发中自行选择。

发生的错误 | 推荐错误码
--- | ---
腾讯服务器加载图片失败，消息发送失败 | `34001`
聊天机器人在群内被禁言，无法发送消息 | `34002`
用户不存在，无法执行此动作 | `35001`
下载图片失败导致消息发送失败 | `33001`

## 保留错误段

保留错误段是保留今后对 OneBot 标准进行升级和扩充内容时使用的，现在保留了所有 4 和 5 开头的五位错误码。

在 OneBot 逻辑端处理错误码时，如果只是做宽泛的处理，不细分错误类型**可以**只判断前一位或前两位。
